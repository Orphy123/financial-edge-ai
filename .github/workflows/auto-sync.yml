name: ðŸš€ Auto-Sync & Deploy

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  auto-sync:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“‚ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ðŸ”§ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ðŸ“¦ Install Dependencies
      run: npm ci
      
    - name: ðŸ—ï¸ Build Project
      run: npm run build
      
    - name: ðŸ§ª Run Tests
      run: npm run test --if-present
      
    - name: ðŸ“Š Bundle Size Analysis
      run: |
        npm run build
        echo "## ðŸ“¦ Bundle Size Report" >> $GITHUB_STEP_SUMMARY
        if command -v du &> /dev/null; then
          echo "| File | Size |" >> $GITHUB_STEP_SUMMARY
          echo "|------|------|" >> $GITHUB_STEP_SUMMARY
          find dist -name "*.js" -o -name "*.css" | head -10 | while read file; do
            size=$(du -h "$file" | cut -f1)
            echo "| $file | $size |" >> $GITHUB_STEP_SUMMARY
          done
        fi
        
    - name: ðŸ” Code Quality Check
      run: |
        echo "## ðŸ” Code Quality Report" >> $GITHUB_STEP_SUMMARY
        if command -v find &> /dev/null; then
          tsx_files=$(find src -name "*.tsx" -o -name "*.ts" | wc -l)
          echo "- TypeScript/TSX files: $tsx_files" >> $GITHUB_STEP_SUMMARY
          echo "- Last commit: $(git log -1 --pretty=format:'%h - %s (%an, %cr)')" >> $GITHUB_STEP_SUMMARY
        fi
        
    - name: ðŸ“ˆ Performance Metrics
      run: |
        echo "## âš¡ Performance Metrics" >> $GITHUB_STEP_SUMMARY
        echo "- Build completed successfully âœ…" >> $GITHUB_STEP_SUMMARY
        echo "- Node version: $(node --version)" >> $GITHUB_STEP_SUMMARY
        echo "- NPM version: $(npm --version)" >> $GITHUB_STEP_SUMMARY
        
    - name: ðŸ”” Notify Success
      if: success()
      run: |
        echo "## âœ… Auto-Sync Completed Successfully" >> $GITHUB_STEP_SUMMARY
        echo "All checks passed! The project has been successfully synchronized." >> $GITHUB_STEP_SUMMARY
        
    - name: ðŸš¨ Notify Failure
      if: failure()
      run: |
        echo "## âŒ Auto-Sync Failed" >> $GITHUB_STEP_SUMMARY
        echo "Some checks failed. Please review the logs above." >> $GITHUB_STEP_SUMMARY 